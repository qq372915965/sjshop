<!DOCTYPE html>
<html lang="zh-CN">
<head>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
		<meta name="Keywords" content="" />
		<meta name="Description" content="" />

		<!--check css-->
		<script src="__PUBLIC__/Home/js/modernizr-2.6.2.min.js" type="text/javascript" charset="utf-8"></script>
		<!--css3 prefix-->
		<script src="__PUBLIC__/Home/js/prefix-css3.min.js" type="text/javascript" charset="utf-8"></script>
		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lte IE 8]>
			<script src="js/html5shiv.js" type="text/javascript" charset="utf-8"></script>
			<script src="js/respond.min.js" type="text/javascript" charset="utf-8"></script>
		<![endif]-->

		<!--css-->
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/cstfont/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/Home/css/all.css" />
	</head>
<body>
    <div class="invoice">
        <h4 class="invoice-ttl">添加收货地址</h4>

        <!--第一次新增地址-->
        <div class="form form-horizontal invoice-address" novalidate="novalidate">
            <div class="form-group vd-box">
                <label class="col-xs-2 control-label" for="re_goods">收货人:</label>
                <div class="col-xs-6">
                    <input class="form-control rd-no vd-item" name="consignee" vd-req vd-req-msg="收货人不能为空" type="text" placeholder="输入收货人" id="re_goods" value="{$list['consignee']}" />
                    <input type="hidden" name="address_id" value="{$address_id}">
                    <input type="hidden" name="user_id" value="{$user_id}">
                    <span class="vd-req "></span>
                </div>
            </div>

            <div class="form-group vd-box">
                <label class="col-xs-2 control-label" for="addr">所在地区:</label>

                <div class="col-xs-6 tree-address-big ">
                    <input class="form-control rd-no vd-item tree-address-btn" name="addr" vd-req vd-req-msg="所在地区不能为空" type="text" placeholder="输入所在地区" id="addr" value="{$list['province']}-{$list['city']}-{$list['district']}"/>
                    <div class="tree-address tab-big">
                        <ul class="tree-address-ttl tab-ttl clearfix">
                            <li class="tab-item active" data-target=".address1">省</li>
                            <li class="tab-item" data-target=".address2">市</li>
                            <li class="tab-item" data-target=".address3">区</li>
                        </ul>
                        <div class="tab-content">
                            <ul class="tree-address-1 tab-content-item active clearfix address1"></ul>
                            <ul class="tree-address-2 tab-content-item clearfix address2"></ul>
                            <ul class="tree-address-3 tab-content-item clearfix address3"></ul>
                        </div>

                    </div>
                    <span class="vd-req "></span>
                </div>

            </div>

            <div class="form-group vd-box">
                <label class="col-xs-2 control-label" for="re_goods">详细地址:</label>
                <div class="col-xs-6">
                    <textarea class=" form-control rd-no vd-item" name="detaddr" vd-req vd-req-msg="详细地址不能为空" placeholder="输入详细地址" >{$list['address']}</textarea>
                    <span class="vd-req "></span>
                </div>
            </div>

            <div class="form-group vd-box">
                <label class="col-xs-2 control-label" for="zipcode">邮编:</label>
                <div class="col-xs-6">
                <input class="form-control rd-no vd-item" type="text" name="zipcode" vd-req vd-req-msg="邮编不能为空" placeholder="输入邮编" id="zipcode" value="{$list['zipcode']}" />
                    <span class="vd-req "></span>
                </div>
            </div>

            <div class="form-group vd-box">
                <label class="col-xs-2 control-label" for="phone">手机:</label>
                <div class="col-xs-6">
                    <input class="form-control rd-no vd-item" type="text" vd-pattern="^1\d{10}$" vd-pattern-msg="手机格式不对" maxlength="11" vd-req vd-req-msg="手机不能为空" placeholder="输入手机号码" name="phone" id="phone" value="{$list['mobile']}"/>
                    <span class="vd-req "></span>
                    <span class="vd-pattern"></span>
                </div>
            </div>

            <div class="form-group  relative">

                <div class="col-xs-offset-2 col-xs-6">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" {$checked} class="vd-item" name="df" value="" vd-ck vd-ck-not vd-ck-true="1" vd-ck-false="2" />
                            设为默认收货地址
                        </label>
                    </div>
                </div>

                <span class="remark">设置后系统将在下单时自动选中该收货地址</span>
            </div>

            <div class="form-group">
                <div class="col-xs-offset-2 col-xs-6">
                    <button class="btn   btn-primary rd-no vd-btn"> 添加收货地址</button>
                    <a class="btn btn-default rd-no" href="收货地址列表.html"> 取消</a>
                </div>

            </div>

        </div>


    </div>

    <script src="__PUBLIC__/Home/js/config.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/Home/js/jquery-1.11.0.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/Home/js/city.data-3.js" type="text/javascript" charset="utf-8"></script>
    <script src="__PUBLIC__/Home/js/all.js" type="text/javascript" charset="utf-8"></script>
    <!--[if lte IE 8]>
        <script src="js/ie8.js" type="text/javascript" charset="utf-8"></script>
    <![endif]-->

    <script type="text/javascript">

        $(function () {

            // 设置模板页iframe的高度
            iframe.setHeight();

            // 添加地址
            var vd1 = vd.create(".form");
            vd1.init();
            $(".form .vd-btn").on("click", function () {

                var $this = this;
                // 是否验证成功
                vd1.isSuccess(function (obj) {
                    vd1.disabled($(vd1.formName).find(".vd-item")); //禁用
                    vd1.disabled($this); //禁用
                    //vd1.enabled(this); //激活
                    var id = $('input[name=address_id]').val();
                    var user_id = $('input[name=user_id]').val();
                    $($this).text("提交正在中...");
                    if(id){
                            $.ajax({
                            url:'__MODULE__/Cart/add_address',
                            dataType:'json',
                            type:'post',
                            data:{
                                "address":obj,
                                "user_id":user_id,
                                "address_id":id
                            },
                            success:function(data){
                                $.info("修改成功", "danger");
                                window.location.assign('address_list.html?user_id='+user_id);
                            }

                        })
                    }else{
                        $.ajax({
                            url:'__MODULE__/Cart/add_address',
                            dataType:'json',
                            type:'post',
                            data:{
                                "address":obj,
                                "user_id":user_id
                            },
                            success:function(data){
                            $.info("添加成功", "danger");
                            window.location.assign('address_list.html?user_id='+user_id);
                         }

                        })
                    }
                    
                    // 设置模板页iframe的高度
                    iframe.setHeight();

                }, function (obj) {
                    //alert(obj.errorMsg)
                    obj.el.focus();
                    // 设置模板页iframe的高度
                    iframe.setHeight();

                });
            });

            treeSelectAddress.init();

        })
    </script>
</body>